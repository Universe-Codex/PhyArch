<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PhyArch Builder IDE</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <style>
        /* Formal CAD Interface Styles */
        :root { --bg: #0a0a0c; --panel: #1a1a20; --text: #e0e0e0; --accent: #00ff88; --border: #333; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Courier New', Courier, monospace; }
        body { background: var(--bg); color: var(--text); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Top Navigation / Status */
        header { background: var(--panel); border-bottom: 1px solid var(--border); padding: 10px; display: flex; justify-content: space-between; font-size: 14px; font-weight: bold; z-index: 10; }
        .status-light { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: red; margin-right: 5px; }
        .active { background: var(--accent); box-shadow: 0 0 8px var(--accent); }

        /* Main 3D Viewport */
        #viewport { flex-grow: 1; position: relative; width: 100%; background: #000; }
        canvas { display: block; width: 100%; height: 100%; }

        /* Bottom Console & Builder Tools */
        #console-panel { background: var(--panel); border-top: 1px solid var(--border); height: 35%; display: flex; flex-direction: column; z-index: 10; }
        #log-output { flex-grow: 1; padding: 10px; overflow-y: auto; font-size: 12px; color: #aaa; border-bottom: 1px solid var(--border); background: #111; }
        .input-area { display: flex; padding: 10px; gap: 10px; }
        input[type="text"] { flex-grow: 1; background: #222; border: 1px solid var(--border); color: var(--accent); padding: 10px; border-radius: 4px; font-size: 14px; outline: none; }
        button { background: #333; color: white; border: 1px solid var(--border); padding: 10px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        button:active { background: var(--accent); color: black; }
    </style>
</head>
<body>

    <header>
        <div>PhyArch Builder v1.0</div>
        <div>
            <span id="indicator-py" class="status-light"></span> Pyodide
            <span id="indicator-gh" class="status-light" style="margin-left: 10px;"></span> Factory
        </div>
    </header>

    <main id="viewport"></main>

    <section id="console-panel">
        <div id="log-output">
            <div>> System Initializing...</div>
            <div>> Loading WebGL Framework...</div>
        </div>
        <div class="input-area">
            <input type="text" id="physics-input" placeholder="Enter LLM Prompt or Equation (e.g., F = m * a)" autocomplete="off">
            <button onclick="executeLogic()">Inject</button>
        <div style="display: flex; gap: 10px; padding: 10px; flex-wrap: wrap; justify-content: center; background: rgba(0,0,0,0.3);">
    <button onclick="quickInvent('AI', 'ai')" style="background: #004422; border: 1px solid #00ff88; padding: 8px 15px; color: white; border-radius: 4px;">+ AI Bot</button>
    <button onclick="quickInvent('Fixer', 'architect')" style="background: #442200; border: 1px solid #ff8800; padding: 8px 15px; color: white; border-radius: 4px;">+ Fixer</button>
    <button onclick="quickInvent('Social', 'social')" style="background: #002244; border: 1px solid #0088ff; padding: 8px 15px; color: white; border-radius: 4px;">+ Social</button>
    <button onclick="quickInvent('Doc', 'writer')" style="background: #440044; border: 1px solid #ff00ff; padding: 8px 15px; color: white; border-radius: 4px;">+ Writer</button>
    <button onclick="quickInvent('Search', 'researcher')" style="background: #004444; border: 1px solid #00ffff; padding: 8px 15px; color: white; border-radius: 4px;">+ Search</button>
        </div>
    </section>

    <script type="module">
        /* ==========================================
           MODULE 1: UI & LOGGING
        ========================================== */
        const logWindow = document.getElementById('log-output');
        function systemLog(message, color="#aaa") {
            logWindow.innerHTML += `<div style="color:${color}">> ${message}</div>`;
            logWindow.scrollTop = logWindow.scrollHeight;
        }

        /* ==========================================
           MODULE 2: THREE.JS 3D ENGINE
        ========================================== */
       /* ==========================================
   MODULE 1: THE HANDS (GITHUB BRIDGE)
========================================== */
import { Octokit } from "https://esm.sh/@octokit/rest";

// This function will eventually use your Secret Token to "Push" your new apps
async function deployInvention(name, content) {
    systemLog(`Initiating Factory Build for: ${name}...`, "yellow");
    // Deployment logic will go here once you have your Secret Token
}
        
        const viewport = document.getElementById('viewport');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.05);

        // Professional Grid & Axis helpers for architecture
        scene.add(new THREE.GridHelper(20, 20, 0x444444, 0x222222));
        scene.add(new THREE.AxesHelper(5));

        const camera = new THREE.PerspectiveCamera(60, viewport.clientWidth / viewport.clientHeight, 0.1, 1000);
        camera.position.set(5, 5, 5);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(viewport.clientWidth, viewport.clientHeight);
        viewport.appendChild(renderer.domElement);

        // Core visual object (Placeholder for physics manipulation)
        const geometry = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff88, wireframe: true });
        const coreMesh = new THREE.Mesh(geometry, material);
        scene.add(coreMesh);

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();

        /* ==========================================
           MODULE 3: PYTHON (PYODIDE) ENGINE
        ========================================== */
        let pyodideInstance;
        
        async function initPythonEngine() {
            systemLog("Booting Pyodide Engine...", "yellow");
            try {
                pyodideInstance = await loadPyodide();
                await pyodideInstance.loadPackage("micropip");
                const micropip = pyodideInstance.pyimport("micropip");
                
                systemLog("Installing SymPy & NumPy (Local Sandbox)...", "yellow");
                await micropip.install('sympy');
                await micropip.install('numpy');
                
                document.getElementById('indicator-py').classList.add('active');
                systemLog("Python Engine Active. Ready for complex logic.", "#00ff88");
            } catch (err) {
                systemLog("Engine Boot Failed: " + err, "red");
            }
        }
        
        // Start engine in background
        initPythonEngine();
/* ==========================================
   MODULE 4: EXECUTION BRIDGE (MASTER)
========================================== */
async function executeLogic() {
    const input = document.getElementById('physics-input').value;
    if(!input) return;

    // 1. Handle Authentication (The Hands)
    if (input.startsWith("auth ")) {
        const token = input.split(" ")[1];
        window.githubToken = token;
        systemLog("Factory Access Granted. Hands are active.", "#00ff88");
        document.getElementById('physics-input').value = "";
        return;
    }

    // 2. Handle Inventions (The Soul)
    if (input.startsWith("invent ")) {
        const parts = input.split(" ");
        const name = parts[1];
        const type = parts[2];
        const code = MasterCreator.inventApp(name, type);
MasterCreator.exportInvention(name, code);
        document.getElementById('physics-input').value = "";
        return;
    }

    // 3. Handle Standard Logic/Physics
    systemLog(`Processing: ${input}`, "#fff");
    document.getElementById('physics-input').value = "";

    if (!pyodideInstance) {
        systemLog("Error: Python Engine not ready yet.", "red");
        return;
    }

    // Visual feedback
    coreMesh.scale.set(Math.random()*2 + 0.5, Math.random()*2 + 0.5, Math.random()*2 + 0.5);
}
        
/* ==========================================
   MODULE 6: MASTER CREATOR (AUTO-INVENT)
========================================== */
const MasterCreator = {
    
    researcher: `
    const searchWiki = async (query) => {
        const response = await fetch('https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=' + query + '&format=json&origin=*');
        const data = await response.json();
        document.getElementById('results').innerHTML = data.query.search.map(s => \`<div><b>\${s.title}</b><br>\${s.snippet}</div>\`).join('<hr>');
    };
    document.body.innerHTML = \`
        <div class="glass-card">
            <input id="q" placeholder="Search Knowledge Base...">
            <button onclick="searchWiki(document.getElementById('q').value)">Search</button>
            <div id="results" style="max-height:300px; overflow-y:auto;"></div>
        </div>
    \`;
`  
    writer: `
    // Full-screen Clean UI (No 3D)
    document.body.innerHTML = \`
        <div class="glass-card" style="height: 90vh;">
            <h2 contenteditable="true">Untitled Document</h2>
            <div id="editor" contenteditable="true" style="flex-grow: 1; outline: none;">
                Start typing your sovereign thoughts here...
            </div>
        </div>
    \`;
`
    inventApp: function(name, type) {
        systemLog(`Synthesizing Native ${type}: ${name}...`, "yellow");
        
        const blueprints = {
    architect: `
    // Native Logic Debugger
    const checkLogic = () => {
        const userCode = document.getElementById('debug-area').value;
        if (userCode.split('{').length !== userCode.split('}').length) {
            systemLog("Architect: Missing a bracket { }.", "red");
        } else {
            systemLog("Architect: Logic structure is valid.", "#00ff88");
        }
    };
    document.body.innerHTML += '<div class="glass-card"><h3>Code Architect</h3><textarea id="debug-area" style="width:100%;height:100px;background:#111;color:#00ff88;"></textarea><button onclick="checkLogic()">Fix My Code</button></div>';
`
    media: `
        // Native Video Rendering Engine
        console.log("Video Engine Active.");
        const canvas = document.createElement('canvas');
        document.body.appendChild(canvas);
        // Space for FFmpeg.wasm processing hooks
    `
}, // This comma separates inventApp from exportInvention

    // 2. The Physical Birth with Architectural Design
    exportInvention: function(name, logic) {
        const content = `
        <html>
        <head>
            <style>
                body { background: #0a0a0c; color: #00ff88; font-family: monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; }
                .glass-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(0,255,136,0.3); border-radius: 15px; padding: 20px; backdrop-filter: blur(10px); width: 90%; }
                button { background: #111; color: #00ff88; border: 1px solid #00ff88; padding: 10px; border-radius: 5px; cursor: pointer; }
                button:hover { background: #00ff88; color: #000; }
            </style>
        </head>
        <body>
            <div class="glass-card">
                <h1>\${name}</h1>
                <hr style="border-color: #333;">
                <script>${logic}<\/script>
            </div>
        </body>
        </html>`;

        const blob = new Blob([content], { type: 'text/html' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `\${name}.html`;
        link.click();
        systemLog(`Invention \${name} birthed with Architect Style.`, "#00ff88");
    }
}; // This MUST be the ONLY closing bracket for MasterCreator
        // Handle Resizing
        window.addEventListener('resize', () => {
            camera.aspect = viewport.clientWidth / viewport.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(viewport.clientWidth, viewport.clientHeight);
        });
        // 3. Easy Button Logic
window.quickInvent = function(name, type) {
    const input = document.getElementById('physics-input');
    if (input) {
        input.value = `invent ${name} ${type}`;
        executeLogic(); // This triggers the birth automatically
    }
};
</body>
</html>
