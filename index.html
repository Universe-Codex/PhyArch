<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PhyArch NEXUS v16 â€” Sovereign OS</title>

  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/examples/js/controls/OrbitControls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.min.js"></script>

  <style>
    :root { --accent: #00ffb2; --bg: #000; --glass: rgba(5, 5, 10, 0.85); }
    * { margin:0; padding:0; box-sizing:border-box; cursor: none !important; }
    body { background:var(--bg); color:#fff; font-family: 'JetBrains Mono', monospace; overflow:hidden; }

    /* --- GLOBAL UI COMPONENTS --- */
    #cursor { position: fixed; width: 18px; height: 18px; border: 1px solid var(--accent); border-radius: 50%; pointer-events: none; z-index: 10000; }
    
    #os-header {
      position: fixed; top: 0; width: 100%; height: 50px; background: rgba(0,0,0,0.5);
      display: flex; align-items: center; padding: 0 20px; z-index: 5000;
      border-bottom: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px);
    }

    /* --- MODULAR WIDGETS --- */
    .widget {
      position: fixed; background: var(--glass); backdrop-filter: blur(30px);
      border: 1px solid rgba(0,255,178,0.2); border-radius: 8px; padding: 15px;
      z-index: 1000; display: none; /* Hidden by default */
      transition: opacity 0.3s;
    }
    .widget.visible { display: block; }

    #pref-matrix { top: 60px; right: 20px; width: 220px; }
    #omni-forge { top: 60px; left: 20px; width: 340px; }
    #ai-observer { bottom: 20px; left: 20px; width: 400px; height: 120px; overflow-y: auto; font-size: 11px; }

    /* --- STYLING --- */
    .toggle-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 10px; align-items: center; }
    input[type="checkbox"] { accent-color: var(--accent); width: 16px; height: 16px; }
    textarea { width: 100%; background: #000; border: 1px solid #222; color: var(--accent); padding: 8px; font-size: 11px; margin: 10px 0; border-radius: 4px; }
    .btn { background: var(--accent); color: #000; border: none; padding: 8px; width: 100%; border-radius: 4px; font-weight: 800; cursor: pointer; }
    .ai-line { color: var(--accent); opacity: 0.8; margin-bottom: 4px; border-left: 2px solid var(--accent); padding-left: 8px; }
  </style>
</head>
<body>

<div id="cursor"></div>

<header id="os-header">
  <div style="color:var(--accent); font-weight:900; cursor:pointer;" onclick="toggleWidget('pref-matrix')">NEXUS_OS // MENU</div>
</header>

<div id="pref-matrix" class="widget visible">
  <span style="font-size: 10px; opacity: 0.5;">PREFERENCES MATRIX</span>
  <hr style="border:0; border-top:1px solid #222; margin:10px 0;">
  <div class="toggle-row"><span>FORGE KERNEL</span> <input type="checkbox" checked onclick="toggleWidget('omni-forge')"></div>
  <div class="toggle-row"><span>AI OBSERVER</span> <input type="checkbox" checked onclick="toggleWidget('ai-observer')"></div>
  <div class="toggle-row"><span>THERMAL VISION</span> <input type="checkbox" id="thermal-toggle" checked></div>
  <div class="toggle-row"><span>SOUNDSCAPE</span> <input type="checkbox" id="audio-toggle"></div>
  <button class="btn" style="margin-top:10px;" onclick="saveConfig()">SAVE CONFIG</button>
</div>

<div id="omni-forge" class="widget visible">
  <span style="font-size: 10px; opacity: 0.5;">OMNI-FORGE</span>
  <textarea id="forge-cmd" rows="3" placeholder="Model: 'Black Hole', 'Fluidity'..."></textarea>
  <button class="btn" onclick="runForge()">EXECUTE</button>
</div>

<div id="ai-observer" class="widget visible">
  <div class="ai-line">System initialized. Waiting for matter...</div>
</div>

<div id="viewport"></div>

<script>
let scene, camera, renderer, world, entities = [], audioCtx = null;
let raycaster = new THREE.Raycaster(), mouse = new THREE.Vector2();

function init() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
  camera.position.set(100, 100, 100);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.getElementById('viewport').appendChild(renderer.domElement);

  new THREE.OrbitControls(camera, renderer.domElement);
  world = new CANNON.World({ gravity: new CANNON.Vec3(0, -9.81, 0) });
  scene.add(new THREE.GridHelper(500, 50, 0x00ffb2, 0x050510));

  window.onmousemove = (e) => {
    document.getElementById('cursor').style.left = e.clientX + 'px';
    document.getElementById('cursor').style.top = e.clientY + 'px';
  };

  animate();
  observe("NEXUS Kernel online. Version 16.0 Ready.");
}

function toggleWidget(id) {
  document.getElementById(id).classList.toggle('visible');
}

function observe(text) {
  const container = document.getElementById('ai-observer');
  const line = document.createElement('div');
  line.className = 'ai-line';
  line.innerText = `> ${text}`;
  container.prepend(line);
}

function runForge() {
  const input = document.getElementById('forge-cmd').value;
  if(input.includes('spawn')) {
    spawn(10);
    observe("Injecting matter into local space.");
  } else {
    observe(`Reconfiguring reality model: ${input}`);
  }
}

function spawn(count) {
  for(let i=0; i<count; i++) {
    const mesh = new THREE.Mesh(new THREE.IcosahedronGeometry(2, 1), new THREE.MeshPhongMaterial({ wireframe: true, color: 0x00ffb2 }));
    const body = new CANNON.Body({ mass: 1, shape: new CANNON.Sphere(2) });
    body.position.set((Math.random()-0.5)*80, 50, (Math.random()-0.5)*80);
    scene.add(mesh);
    world.addBody(body);
    entities.push({ mesh, body });
  }
}

function animate() {
  requestAnimationFrame(animate);
  world.step(1/60);
  
  const useThermal = document.getElementById('thermal-toggle').checked;

  entities.forEach(e => {
    e.mesh.position.copy(e.body.position);
    e.mesh.quaternion.copy(e.body.quaternion);

    if(useThermal) {
      const speed = e.body.velocity.length();
      e.mesh.material.color.setHSL(0.6 - (speed * 0.02), 1, 0.5);
    } else {
      e.mesh.material.color.setHex(0x00ffb2);
    }
  });

  renderer.render(scene, camera);
}

function saveConfig() {
  const config = {
    thermal: document.getElementById('thermal-toggle').checked,
    audio: document.getElementById('audio-toggle').checked
  };
  localStorage.setItem('NEXUS_CONFIG', JSON.stringify(config));
  observe("Configuration saved to local memory.");
}

init();
</script>
</body>
</html>
