<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhyArch NEXUS 4.1 â€” Connected Spatial Lab</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    
    <style>
        :root {
            --bg: #020205;
            --panel: rgba(10,10,18,0.98);
            --accent: #00ff9d;
            --accent2: #00d0ff;
            --danger: #ff3366;
            --font: 'JetBrains Mono', monospace;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { background:var(--bg); color:#fff; overflow:hidden; height:100vh; display:flex; flex-direction:column; font-family: var(--font); }
        
        header { height:56px; background:#000; border-bottom:1px solid #222; display:flex; align-items:center; padding:0 20px; justify-content:space-between; }
        .logo { font-size:18px; font-weight:900; letter-spacing:4px; }
        .logo span { color:var(--accent); }

        .workspace { flex:1; display:flex; overflow: hidden; }
        #viewport { flex:1; background:#000; cursor: crosshair; }
        
        .sidebar { width:360px; background:var(--panel); border-left:1px solid #222; display:flex; flex-direction:column; }
        .tab-bar { display:flex; background:#05050a; }
        .tab { flex:1; padding:14px; text-align:center; font-size:10px; cursor:pointer; border-bottom:2px solid transparent; opacity: 0.5; }
        .tab-active { border-color:var(--accent); color:var(--accent); opacity: 1; background: rgba(0,255,157,0.05); }
        
        .panel { flex:1; padding:18px; overflow-y:auto; display:none; }
        .panel-active { display:block; }
        
        #console { height:200px; background:#000; border-top:1px solid #222; overflow-y:auto; padding:10px; font-size:11px; color:#666; }
        
        textarea, input { background:#111; border:1px solid #333; color:var(--accent); padding:10px; border-radius:4px; outline: none; font-family: var(--font); width: 100%; }
        button { cursor: pointer; border: none; border-radius: 4px; padding: 10px; font-weight: bold; background: var(--accent); color: #000; margin-top: 10px; }
        
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online { background: var(--accent2); box-shadow: 0 0 10px var(--accent2); }
    </style>
</head>
<body>

<header>
    <div class="logo">PHY<span>ARCH</span> NEXUS <small style="font-size:10px; vertical-align: middle;">[LIVE]</small></div>
    <div id="connection-status" style="font-size: 10px; color: var(--accent2);">
        <span class="status-dot online"></span> SYSTEM CONNECTED
    </div>
</header>

<div class="workspace">
    <div id="viewport"></div>
    
    <aside class="sidebar">
        <div class="tab-bar">
            <div class="tab tab-active" onclick="switchTab(0)">ANALYTICS</div>
            <div class="tab" onclick="switchTab(1)">PYTHON LAB</div>
        </div>
        
        <div id="panel-0" class="panel panel-active">
            <h4 style="color:var(--accent2); font-size: 11px; margin-bottom:10px;">LIVE PROBE</h4>
            <div id="inspector" style="background:rgba(255,255,255,0.03); padding:10px; font-size:11px; border-radius:8px;">Awaiting live stream...</div>
        </div>
        
        <div id="panel-1" class="panel">
            <h4 style="color:var(--accent2); font-size: 11px; margin-bottom:10px;">REAL-TIME KERNEL</h4>
            <textarea id="py-code" spellcheck="false" style="height:350px; font-size:11px;">
# Real-Time Data Example: Market-Driven Physics
import json

async def sync_universe():
    Omni.log("Fetching live Bitcoin data...")
    # Using public API to drive physics scale
    resp = await Omni.get_data("https://api.coinbase.com/v2/prices/BTC-USD/spot")
    data = json.loads(resp)
    price = float(data['data']['amount'])
    
    Omni.log(f"BTC Spot: ${price}")
    # Spawn a box where the size is based on the current price (normalized)
    size = price / 15000 
    Omni.spawn('box', 1, {'pos':{'x':0,'y':20,'z':0}, 'size': size, 'color': 0x00ff9d})

import asyncio
asyncio.ensure_future(sync_universe())
            </textarea>
            <button onclick="runPython()">EXECUTE WITH LIVE DATA</button>
        </div>
    </aside>
</div>

<div id="console" id="log"></div>

<script>
class NexusApp {
    constructor() {
        this.entities = [];
        this.pyodide = null;
    }

    async init() {
        const vp = document.getElementById('viewport');
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(50, vp.clientWidth/vp.clientHeight, 0.1, 1000);
        this.camera.position.set(50, 50, 50);
        this.renderer = new THREE.WebGLRenderer({antialias:true});
        this.renderer.setSize(vp.clientWidth, vp.clientHeight);
        vp.appendChild(this.renderer.domElement);
        this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
        
        this.world = new CANNON.World({ gravity: new CANNON.Vec3(0, -9.8, 0) });
        this.scene.add(new THREE.GridHelper(100, 20, 0x333333, 0x111111));

        // Ground
        const ground = new CANNON.Body({ mass: 0, shape: new CANNON.Plane() });
        ground.quaternion.setFromEuler(-Math.PI/2, 0, 0);
        this.world.addBody(ground);

        this.animate();
        this.log("NEXUS LIVE: Online and ready for network requests.");
    }

    animate() {
        requestAnimationFrame(() => this.animate());
        this.world.fixedStep();
        this.entities.forEach(e => {
            e.mesh.position.copy(e.body.position);
            e.mesh.quaternion.copy(e.body.quaternion);
        });
        this.renderer.render(this.scene, this.camera);
    }

    /**
     * THE BRIDGE: Allows Python to bypass its sandbox and fetch real data
     */
    async fetchRemote(url) {
        try {
            const response = await fetch(url);
            return await response.text();
        } catch (e) {
            return JSON.stringify({error: "Connection failed: " + e.message});
        }
    }

    spawn(type, count, opts = {}) {
        const size = opts.size || 2;
        const geo = type === 'sphere' ? new THREE.SphereGeometry(size) : new THREE.BoxGeometry(size, size, size);
        const shape = type === 'sphere' ? new CANNON.Sphere(size) : new CANNON.Box(new CANNON.Vec3(size/2, size/2, size/2));
        const mesh = new THREE.Mesh(geo, new THREE.MeshPhongMaterial({color: opts.color || 0x00ff9d, wireframe: true}));
        const body = new CANNON.Body({ mass: 1, shape, position: new CANNON.Vec3(opts.pos?.x||0, opts.pos?.y||10, opts.pos?.z||0) });
        
        this.scene.add(mesh);
        this.world.addBody(body);
        this.entities.push({mesh, body});
    }

    log(m) {
        const c = document.getElementById('console');
        c.innerHTML += `<div>>> ${m}</div>`;
        c.scrollTop = c.scrollHeight;
    }
}

const App = new NexusApp();
function switchTab(n) {
    document.querySelectorAll('.tab').forEach((t,i) => t.classList.toggle('tab-active', i===n));
    document.querySelectorAll('.panel').forEach((p,i) => p.classList.toggle('panel-active', i===n));
}

async function runPython() {
    App.log("Kernel processing script...");
    await App.pyodide.runPythonAsync(document.getElementById('py-code').value);
}

(async () => {
    await App.init();
    App.pyodide = await loadPyodide();
    // Expose the app and the network bridge to Python
    App.pyodide.globals.set("Omni", {
        spawn: (t,c,o) => App.spawn(t,c,o.toJs()),
        get_data: (url) => App.fetchRemote(url), // <--- Network bridge
        log: (m) => App.log(m)
    });
    App.log("PYTHON: AI Kernel Online with Network Access.");
})();
</script>
</body>
</html>
